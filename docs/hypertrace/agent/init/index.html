<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />
<meta name="generator" content="pdoc 0.10.0" />
<title>hypertrace.agent.init API documentation</title>
<meta name="description" content="Initialize all the components using configuration from AgentConfig" />
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/sanitize.min.css" integrity="sha256-PK9q560IAAa6WVRRh76LtCaI8pjTJ2z11v0miyNNjrs=" crossorigin>
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/typography.min.css" integrity="sha256-7l/o7C8jubJiy74VsKTidCy1yBkRtiUGbVkYBylBqUg=" crossorigin>
<link rel="stylesheet preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/styles/github.min.css" crossorigin>
<style>:root{--highlight-color:#fe9}.flex{display:flex !important}body{line-height:1.5em}#content{padding:20px}#sidebar{padding:30px;overflow:hidden}#sidebar > *:last-child{margin-bottom:2cm}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #ddd;text-align:right}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:1em 0 .50em 0}h3{font-size:1.4em;margin:25px 0 10px 0}h4{margin:0;font-size:105%}h1:target,h2:target,h3:target,h4:target,h5:target,h6:target{background:var(--highlight-color);padding:.2em 0}a{color:#058;text-decoration:none;transition:color .3s ease-in-out}a:hover{color:#e82}.title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#900}pre code{background:#f8f8f8;font-size:.8em;line-height:1.4em}code{background:#f2f2f1;padding:1px 4px;overflow-wrap:break-word}h1 code{background:transparent}pre{background:#f8f8f8;border:0;border-top:1px solid #ccc;border-bottom:1px solid #ccc;margin:1em 0;padding:1ex}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index h3{border-bottom:1px solid #ddd}#index ul{padding:0}#index h4{margin-top:.6em;font-weight:bold}@media (min-width:200ex){#index .two-column{column-count:2}}@media (min-width:300ex){#index .two-column{column-count:3}}dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 3em}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#eee;font-weight:bold;font-size:.85em;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#e0e0e0}dt:target .name{background:var(--highlight-color)}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.inherited{color:#999;border-left:5px solid #eee;padding-left:1em}.inheritance em{font-style:normal;font-weight:bold}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:inherit}.source summary,.git-link-div{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase}.source summary > *{white-space:nowrap;cursor:pointer}.git-link{color:inherit;margin-left:1em}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{font-size:12px;overflow:visible}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1em}img{max-width:100%}td{padding:0 .5em}.admonition{padding:.1em .5em;margin-bottom:1em}.admonition-title{font-weight:bold}.admonition.note,.admonition.info,.admonition.important{background:#aef}.admonition.todo,.admonition.versionadded,.admonition.tip,.admonition.hint{background:#dfd}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#fd4}.admonition.error,.admonition.danger,.admonition.caution{background:lightpink}</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){#sidebar{width:30%;height:100vh;overflow:auto;position:sticky;top:0}#content{width:70%;max-width:100ch;padding:3em 4em;border-left:1px solid #ddd}pre code{font-size:1em}.item .name{font-size:1em}main{display:flex;flex-direction:row-reverse;justify-content:flex-end}.toc ul ul,#index ul{padding-left:1.5em}.toc > ul > li{margin-top:.5em}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/highlight.min.js" integrity="sha256-Uv3H6lx7dJmRfRvH8TH6kJD1TSK1aFcwgx+mdg3epi8=" crossorigin></script>
<script>window.addEventListener('DOMContentLoaded', () => hljs.initHighlighting())</script>
</head>
<body>
<main>
<article id="content">
<header>
<h1 class="title">Module <code>hypertrace.agent.init</code></h1>
</header>
<section id="section-intro">
<p>Initialize all the components using configuration from AgentConfig</p>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">&#39;&#39;&#39;Initialize all the components using configuration from AgentConfig&#39;&#39;&#39;
import sys
import os
import traceback
import logging
from typing import Union

from opentelemetry import trace
from opentelemetry.sdk.trace import TracerProvider, export
from opentelemetry.sdk.trace.export import ConsoleSpanExporter, SimpleSpanProcessor
from opentelemetry.exporter.zipkin.proto.http import ZipkinExporter
from opentelemetry.exporter.otlp.proto.grpc.trace_exporter import OTLPSpanExporter
from opentelemetry.trace import ProxyTracerProvider
from opentelemetry.sdk.resources import Resource
from opentelemetry.sdk.trace.export import BatchSpanProcessor
from hypertrace.agent import constants
from hypertrace.agent.config import config_pb2, AgentConfig

# Initialize logger
logger = logging.getLogger(__name__)  # pylint: disable=C0103


class AgentInit:  # pylint: disable=R0902,R0903
    &#39;&#39;&#39;Initialize all the OTel components using configuration from AgentConfig&#39;&#39;&#39;

    def __init__(self, agent_config: AgentConfig):
        &#39;&#39;&#39;constructor&#39;&#39;&#39;
        logger.debug(&#39;Initializing AgentInit object.&#39;)
        self._config = agent_config

        # Only available in python &gt; 3.7
        # this does prevent user from having to add post fork hooks to their
        # web server config
        if hasattr(os, &#39;register_at_fork&#39;):
            logger.info(&#39;Registering after_in_child handler.&#39;)
            os.register_at_fork(after_in_child=self.post_fork)  # pylint:disable=E1101

        try:
            self.apply_config(None)

        except Exception as err:  # pylint: disable=W0703
            logger.error(&#39;Failed to initialize tracer: exception=%s, stacktrace=%s&#39;,
                         err,
                         traceback.format_exc())
            raise sys.exc_info()[0]

    def post_fork(self):
        &#34;&#34;&#34;Used to reinitialize exporter &amp; processors in separate worker processes&#34;&#34;&#34;
        self.apply_config(None)  # pylint:disable=W0212

    def apply_config(self, agent_config: (Union[None, AgentConfig])):
        &#34;&#34;&#34;Initialize various aspects of the agent based on the most recent config&#34;&#34;&#34;
        if agent_config:
            self._config = agent_config

        self.init_trace_provider()
        self.init_propagation()

        if self._config.use_console_span_exporter():
            self.set_console_span_processor()
        else:
            self.init_exporter()


    def init_trace_provider(self) -&gt; None:
        &#39;&#39;&#39;Initialize trace provider and set resource attributes.&#39;&#39;&#39;
        if isinstance(trace.get_tracer_provider(), ProxyTracerProvider):
            logger.debug(&#34;no configured trace provider detected, adding one&#34;)
            resource_attributes = {
                &#34;service.name&#34;: self._config.agent_config.service_name,
                &#34;service.instance.id&#34;: os.getpid(),
                &#34;telemetry.sdk.version&#34;: constants.TELEMETRY_SDK_VERSION,
                &#34;telemetry.sdk.name&#34;: constants.TELEMETRY_SDK_NAME,
                &#34;telemetry.sdk.language&#34;: constants.TELEMETRY_SDK_LANGUAGE
            }
            if self._config.agent_config.resource_attributes:
                logger.debug(
                    &#39;Custom attributes found. Adding to resource attributes dict.&#39;)
                resource_attributes.update(
                    self._config.agent_config.resource_attributes)
            tracer_provider = TracerProvider(
                resource=Resource.create(resource_attributes)
            )
            trace.set_tracer_provider(tracer_provider)
        else:
            logger.debug(&#34;tracer provider already configured, &#34;
                         &#34;skipping trace provider configuration&#34;)

    def init_exporter(self) -&gt; None:
        &#34;&#34;&#34;Initialize exporter&#34;&#34;&#34;
        reporter_type = self._config.agent_config.reporting.trace_reporter_type
        self._init_exporter(reporter_type)

    def init_propagation(self) -&gt; None:
        &#39;&#39;&#39;Initialize requested context propagation protocols.&#39;&#39;&#39;
        propagator_list = []
        for prop_format in self._config.agent_config.propagation_formats:
            if prop_format == config_pb2.PropagationFormat.TRACECONTEXT:
                from opentelemetry.trace.propagation.tracecontext \
                  import TraceContextTextMapPropagator # pylint: disable=C0415
                propagator_list += [ TraceContextTextMapPropagator() ]
                logger.debug(&#39;Adding TRACECONTEXT trace propagator to list.&#39;)
            if prop_format == config_pb2.PropagationFormat.B3:
                from opentelemetry.propagators.b3 import B3Format  # pylint: disable=C0415
                propagator_list += [ B3Format() ]
                logger.debug(&#39;Adding B3 trace propagator to list.&#39;)

        if len(propagator_list) == 0:
            logger.debug(&#39;No propagators have been initialized.&#39;)

        logger.debug(&#39;propagator_list: %s&#39;, str(propagator_list))
        from opentelemetry.propagate import set_global_textmap # pylint: disable=C0415
        from opentelemetry.propagators.composite import CompositePropagator # pylint: disable=C0415
        composite_propagators = CompositePropagator(propagator_list)
        set_global_textmap(composite_propagators)

    def _set_wrapper_fields(self, wrapper):
        data_cap = self._config.agent_config.data_capture
        wrapper.set_process_request_headers(data_cap.http_headers.request)
        wrapper.set_process_request_body(data_cap.http_body.request)
        wrapper.set_process_response_headers(data_cap.http_headers.response)
        wrapper.set_process_response_body(data_cap.http_body.response)
        wrapper.set_body_max_size(data_cap.body_max_size_bytes)

    def init_library_instrumentation(self, instrumentation_name, wrapper_instance):
        &#34;&#34;&#34;used to configure instrumentation wrapper settings + apply instrumentation&#34;&#34;&#34;
        logger.debug(&#34;Attempting to initialize %s instrumentation&#34;, instrumentation_name)
        try:
            self._set_wrapper_fields(wrapper_instance)
            wrapper_instance.instrument()
        except Exception as err: # pylint: disable=W0703
            logger.debug(constants.INST_WRAP_EXCEPTION_MSSG,
                         instrumentation_name,
                         err,
                         traceback.format_exc())

    def register_processor(self, processor) -&gt; None:  # pylint:disable=R0201
        &#39;&#39;&#39;Register additional span exporter + processor&#39;&#39;&#39;
        logger.debug(&#39;Entering AgentInit.register_processor().&#39;)
        trace.get_tracer_provider().add_span_processor(processor)

    def set_console_span_processor(self) -&gt; None:
        &#39;&#39;&#39;Register the console span processor for debugging purposes.&#39;&#39;&#39;
        logger.debug(&#39;Entering AgentInit.setConsoleSpanProcessor().&#39;)
        console_span_exporter = ConsoleSpanExporter(
            service_name=self._config.agent_config.service_name)
        simple_export_span_processor = SimpleSpanProcessor(
            console_span_exporter)
        trace.get_tracer_provider().add_span_processor(simple_export_span_processor)

    def _init_exporter(self, trace_reporter_type):
        exporter_type = &#39;&#39;
        try:
            if trace_reporter_type == config_pb2.TraceReporterType.ZIPKIN:
                exporter_type = &#39;zipkin&#39;
                exporter = ZipkinExporter(
                    endpoint=self._config.agent_config.reporting.endpoint
                )
            elif trace_reporter_type == config_pb2.TraceReporterType.OTLP:
                exporter_type = &#39;otlp&#39;
                exporter = OTLPSpanExporter(endpoint=self._config.agent_config.reporting.endpoint,
                                            insecure= not self._config.agent_config.reporting.secure)
            else:
                logger.error(&#34;Unknown exporter type `%s`&#34;, trace_reporter_type)

            span_processor = BatchSpanProcessor(exporter)
            trace.get_tracer_provider().add_span_processor(span_processor)

            logger.info(&#39;Initialized %s exporter reporting to `%s`&#39;,
                        exporter_type,
                        self._config.agent_config.reporting.endpoint)
        except Exception as err:  # pylint: disable=W0703
            logger.error(&#39;Failed to initialize %s exporter: exception=%s, stacktrace=%s&#39;,
                         exporter_type,
                         err,
                         traceback.format_exc())</code></pre>
</details>
</section>
<section>
</section>
<section>
</section>
<section>
</section>
<section>
<h2 class="section-title" id="header-classes">Classes</h2>
<dl>
<dt id="hypertrace.agent.init.AgentInit"><code class="flex name class">
<span>class <span class="ident">AgentInit</span></span>
<span>(</span><span>agent_config: <a title="hypertrace.agent.config.AgentConfig" href="../config/index.html#hypertrace.agent.config.AgentConfig">AgentConfig</a>)</span>
</code></dt>
<dd>
<div class="desc"><p>Initialize all the OTel components using configuration from AgentConfig</p>
<p>constructor</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">class AgentInit:  # pylint: disable=R0902,R0903
    &#39;&#39;&#39;Initialize all the OTel components using configuration from AgentConfig&#39;&#39;&#39;

    def __init__(self, agent_config: AgentConfig):
        &#39;&#39;&#39;constructor&#39;&#39;&#39;
        logger.debug(&#39;Initializing AgentInit object.&#39;)
        self._config = agent_config

        # Only available in python &gt; 3.7
        # this does prevent user from having to add post fork hooks to their
        # web server config
        if hasattr(os, &#39;register_at_fork&#39;):
            logger.info(&#39;Registering after_in_child handler.&#39;)
            os.register_at_fork(after_in_child=self.post_fork)  # pylint:disable=E1101

        try:
            self.apply_config(None)

        except Exception as err:  # pylint: disable=W0703
            logger.error(&#39;Failed to initialize tracer: exception=%s, stacktrace=%s&#39;,
                         err,
                         traceback.format_exc())
            raise sys.exc_info()[0]

    def post_fork(self):
        &#34;&#34;&#34;Used to reinitialize exporter &amp; processors in separate worker processes&#34;&#34;&#34;
        self.apply_config(None)  # pylint:disable=W0212

    def apply_config(self, agent_config: (Union[None, AgentConfig])):
        &#34;&#34;&#34;Initialize various aspects of the agent based on the most recent config&#34;&#34;&#34;
        if agent_config:
            self._config = agent_config

        self.init_trace_provider()
        self.init_propagation()

        if self._config.use_console_span_exporter():
            self.set_console_span_processor()
        else:
            self.init_exporter()


    def init_trace_provider(self) -&gt; None:
        &#39;&#39;&#39;Initialize trace provider and set resource attributes.&#39;&#39;&#39;
        if isinstance(trace.get_tracer_provider(), ProxyTracerProvider):
            logger.debug(&#34;no configured trace provider detected, adding one&#34;)
            resource_attributes = {
                &#34;service.name&#34;: self._config.agent_config.service_name,
                &#34;service.instance.id&#34;: os.getpid(),
                &#34;telemetry.sdk.version&#34;: constants.TELEMETRY_SDK_VERSION,
                &#34;telemetry.sdk.name&#34;: constants.TELEMETRY_SDK_NAME,
                &#34;telemetry.sdk.language&#34;: constants.TELEMETRY_SDK_LANGUAGE
            }
            if self._config.agent_config.resource_attributes:
                logger.debug(
                    &#39;Custom attributes found. Adding to resource attributes dict.&#39;)
                resource_attributes.update(
                    self._config.agent_config.resource_attributes)
            tracer_provider = TracerProvider(
                resource=Resource.create(resource_attributes)
            )
            trace.set_tracer_provider(tracer_provider)
        else:
            logger.debug(&#34;tracer provider already configured, &#34;
                         &#34;skipping trace provider configuration&#34;)

    def init_exporter(self) -&gt; None:
        &#34;&#34;&#34;Initialize exporter&#34;&#34;&#34;
        reporter_type = self._config.agent_config.reporting.trace_reporter_type
        self._init_exporter(reporter_type)

    def init_propagation(self) -&gt; None:
        &#39;&#39;&#39;Initialize requested context propagation protocols.&#39;&#39;&#39;
        propagator_list = []
        for prop_format in self._config.agent_config.propagation_formats:
            if prop_format == config_pb2.PropagationFormat.TRACECONTEXT:
                from opentelemetry.trace.propagation.tracecontext \
                  import TraceContextTextMapPropagator # pylint: disable=C0415
                propagator_list += [ TraceContextTextMapPropagator() ]
                logger.debug(&#39;Adding TRACECONTEXT trace propagator to list.&#39;)
            if prop_format == config_pb2.PropagationFormat.B3:
                from opentelemetry.propagators.b3 import B3Format  # pylint: disable=C0415
                propagator_list += [ B3Format() ]
                logger.debug(&#39;Adding B3 trace propagator to list.&#39;)

        if len(propagator_list) == 0:
            logger.debug(&#39;No propagators have been initialized.&#39;)

        logger.debug(&#39;propagator_list: %s&#39;, str(propagator_list))
        from opentelemetry.propagate import set_global_textmap # pylint: disable=C0415
        from opentelemetry.propagators.composite import CompositePropagator # pylint: disable=C0415
        composite_propagators = CompositePropagator(propagator_list)
        set_global_textmap(composite_propagators)

    def _set_wrapper_fields(self, wrapper):
        data_cap = self._config.agent_config.data_capture
        wrapper.set_process_request_headers(data_cap.http_headers.request)
        wrapper.set_process_request_body(data_cap.http_body.request)
        wrapper.set_process_response_headers(data_cap.http_headers.response)
        wrapper.set_process_response_body(data_cap.http_body.response)
        wrapper.set_body_max_size(data_cap.body_max_size_bytes)

    def init_library_instrumentation(self, instrumentation_name, wrapper_instance):
        &#34;&#34;&#34;used to configure instrumentation wrapper settings + apply instrumentation&#34;&#34;&#34;
        logger.debug(&#34;Attempting to initialize %s instrumentation&#34;, instrumentation_name)
        try:
            self._set_wrapper_fields(wrapper_instance)
            wrapper_instance.instrument()
        except Exception as err: # pylint: disable=W0703
            logger.debug(constants.INST_WRAP_EXCEPTION_MSSG,
                         instrumentation_name,
                         err,
                         traceback.format_exc())

    def register_processor(self, processor) -&gt; None:  # pylint:disable=R0201
        &#39;&#39;&#39;Register additional span exporter + processor&#39;&#39;&#39;
        logger.debug(&#39;Entering AgentInit.register_processor().&#39;)
        trace.get_tracer_provider().add_span_processor(processor)

    def set_console_span_processor(self) -&gt; None:
        &#39;&#39;&#39;Register the console span processor for debugging purposes.&#39;&#39;&#39;
        logger.debug(&#39;Entering AgentInit.setConsoleSpanProcessor().&#39;)
        console_span_exporter = ConsoleSpanExporter(
            service_name=self._config.agent_config.service_name)
        simple_export_span_processor = SimpleSpanProcessor(
            console_span_exporter)
        trace.get_tracer_provider().add_span_processor(simple_export_span_processor)

    def _init_exporter(self, trace_reporter_type):
        exporter_type = &#39;&#39;
        try:
            if trace_reporter_type == config_pb2.TraceReporterType.ZIPKIN:
                exporter_type = &#39;zipkin&#39;
                exporter = ZipkinExporter(
                    endpoint=self._config.agent_config.reporting.endpoint
                )
            elif trace_reporter_type == config_pb2.TraceReporterType.OTLP:
                exporter_type = &#39;otlp&#39;
                exporter = OTLPSpanExporter(endpoint=self._config.agent_config.reporting.endpoint,
                                            insecure= not self._config.agent_config.reporting.secure)
            else:
                logger.error(&#34;Unknown exporter type `%s`&#34;, trace_reporter_type)

            span_processor = BatchSpanProcessor(exporter)
            trace.get_tracer_provider().add_span_processor(span_processor)

            logger.info(&#39;Initialized %s exporter reporting to `%s`&#39;,
                        exporter_type,
                        self._config.agent_config.reporting.endpoint)
        except Exception as err:  # pylint: disable=W0703
            logger.error(&#39;Failed to initialize %s exporter: exception=%s, stacktrace=%s&#39;,
                         exporter_type,
                         err,
                         traceback.format_exc())</code></pre>
</details>
<h3>Methods</h3>
<dl>
<dt id="hypertrace.agent.init.AgentInit.apply_config"><code class="name flex">
<span>def <span class="ident">apply_config</span></span>(<span>self, agent_config: Optional[None])</span>
</code></dt>
<dd>
<div class="desc"><p>Initialize various aspects of the agent based on the most recent config</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def apply_config(self, agent_config: (Union[None, AgentConfig])):
    &#34;&#34;&#34;Initialize various aspects of the agent based on the most recent config&#34;&#34;&#34;
    if agent_config:
        self._config = agent_config

    self.init_trace_provider()
    self.init_propagation()

    if self._config.use_console_span_exporter():
        self.set_console_span_processor()
    else:
        self.init_exporter()</code></pre>
</details>
</dd>
<dt id="hypertrace.agent.init.AgentInit.init_exporter"><code class="name flex">
<span>def <span class="ident">init_exporter</span></span>(<span>self) ‑> None</span>
</code></dt>
<dd>
<div class="desc"><p>Initialize exporter</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def init_exporter(self) -&gt; None:
    &#34;&#34;&#34;Initialize exporter&#34;&#34;&#34;
    reporter_type = self._config.agent_config.reporting.trace_reporter_type
    self._init_exporter(reporter_type)</code></pre>
</details>
</dd>
<dt id="hypertrace.agent.init.AgentInit.init_library_instrumentation"><code class="name flex">
<span>def <span class="ident">init_library_instrumentation</span></span>(<span>self, instrumentation_name, wrapper_instance)</span>
</code></dt>
<dd>
<div class="desc"><p>used to configure instrumentation wrapper settings + apply instrumentation</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def init_library_instrumentation(self, instrumentation_name, wrapper_instance):
    &#34;&#34;&#34;used to configure instrumentation wrapper settings + apply instrumentation&#34;&#34;&#34;
    logger.debug(&#34;Attempting to initialize %s instrumentation&#34;, instrumentation_name)
    try:
        self._set_wrapper_fields(wrapper_instance)
        wrapper_instance.instrument()
    except Exception as err: # pylint: disable=W0703
        logger.debug(constants.INST_WRAP_EXCEPTION_MSSG,
                     instrumentation_name,
                     err,
                     traceback.format_exc())</code></pre>
</details>
</dd>
<dt id="hypertrace.agent.init.AgentInit.init_propagation"><code class="name flex">
<span>def <span class="ident">init_propagation</span></span>(<span>self) ‑> None</span>
</code></dt>
<dd>
<div class="desc"><p>Initialize requested context propagation protocols.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def init_propagation(self) -&gt; None:
    &#39;&#39;&#39;Initialize requested context propagation protocols.&#39;&#39;&#39;
    propagator_list = []
    for prop_format in self._config.agent_config.propagation_formats:
        if prop_format == config_pb2.PropagationFormat.TRACECONTEXT:
            from opentelemetry.trace.propagation.tracecontext \
              import TraceContextTextMapPropagator # pylint: disable=C0415
            propagator_list += [ TraceContextTextMapPropagator() ]
            logger.debug(&#39;Adding TRACECONTEXT trace propagator to list.&#39;)
        if prop_format == config_pb2.PropagationFormat.B3:
            from opentelemetry.propagators.b3 import B3Format  # pylint: disable=C0415
            propagator_list += [ B3Format() ]
            logger.debug(&#39;Adding B3 trace propagator to list.&#39;)

    if len(propagator_list) == 0:
        logger.debug(&#39;No propagators have been initialized.&#39;)

    logger.debug(&#39;propagator_list: %s&#39;, str(propagator_list))
    from opentelemetry.propagate import set_global_textmap # pylint: disable=C0415
    from opentelemetry.propagators.composite import CompositePropagator # pylint: disable=C0415
    composite_propagators = CompositePropagator(propagator_list)
    set_global_textmap(composite_propagators)</code></pre>
</details>
</dd>
<dt id="hypertrace.agent.init.AgentInit.init_trace_provider"><code class="name flex">
<span>def <span class="ident">init_trace_provider</span></span>(<span>self) ‑> None</span>
</code></dt>
<dd>
<div class="desc"><p>Initialize trace provider and set resource attributes.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def init_trace_provider(self) -&gt; None:
    &#39;&#39;&#39;Initialize trace provider and set resource attributes.&#39;&#39;&#39;
    if isinstance(trace.get_tracer_provider(), ProxyTracerProvider):
        logger.debug(&#34;no configured trace provider detected, adding one&#34;)
        resource_attributes = {
            &#34;service.name&#34;: self._config.agent_config.service_name,
            &#34;service.instance.id&#34;: os.getpid(),
            &#34;telemetry.sdk.version&#34;: constants.TELEMETRY_SDK_VERSION,
            &#34;telemetry.sdk.name&#34;: constants.TELEMETRY_SDK_NAME,
            &#34;telemetry.sdk.language&#34;: constants.TELEMETRY_SDK_LANGUAGE
        }
        if self._config.agent_config.resource_attributes:
            logger.debug(
                &#39;Custom attributes found. Adding to resource attributes dict.&#39;)
            resource_attributes.update(
                self._config.agent_config.resource_attributes)
        tracer_provider = TracerProvider(
            resource=Resource.create(resource_attributes)
        )
        trace.set_tracer_provider(tracer_provider)
    else:
        logger.debug(&#34;tracer provider already configured, &#34;
                     &#34;skipping trace provider configuration&#34;)</code></pre>
</details>
</dd>
<dt id="hypertrace.agent.init.AgentInit.post_fork"><code class="name flex">
<span>def <span class="ident">post_fork</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"><p>Used to reinitialize exporter &amp; processors in separate worker processes</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def post_fork(self):
    &#34;&#34;&#34;Used to reinitialize exporter &amp; processors in separate worker processes&#34;&#34;&#34;
    self.apply_config(None)  # pylint:disable=W0212</code></pre>
</details>
</dd>
<dt id="hypertrace.agent.init.AgentInit.register_processor"><code class="name flex">
<span>def <span class="ident">register_processor</span></span>(<span>self, processor) ‑> None</span>
</code></dt>
<dd>
<div class="desc"><p>Register additional span exporter + processor</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def register_processor(self, processor) -&gt; None:  # pylint:disable=R0201
    &#39;&#39;&#39;Register additional span exporter + processor&#39;&#39;&#39;
    logger.debug(&#39;Entering AgentInit.register_processor().&#39;)
    trace.get_tracer_provider().add_span_processor(processor)</code></pre>
</details>
</dd>
<dt id="hypertrace.agent.init.AgentInit.set_console_span_processor"><code class="name flex">
<span>def <span class="ident">set_console_span_processor</span></span>(<span>self) ‑> None</span>
</code></dt>
<dd>
<div class="desc"><p>Register the console span processor for debugging purposes.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def set_console_span_processor(self) -&gt; None:
    &#39;&#39;&#39;Register the console span processor for debugging purposes.&#39;&#39;&#39;
    logger.debug(&#39;Entering AgentInit.setConsoleSpanProcessor().&#39;)
    console_span_exporter = ConsoleSpanExporter(
        service_name=self._config.agent_config.service_name)
    simple_export_span_processor = SimpleSpanProcessor(
        console_span_exporter)
    trace.get_tracer_provider().add_span_processor(simple_export_span_processor)</code></pre>
</details>
</dd>
</dl>
</dd>
</dl>
</section>
</article>
<nav id="sidebar">
<h1>Index</h1>
<div class="toc">
<ul></ul>
</div>
<ul id="index">
<li><h3>Super-module</h3>
<ul>
<li><code><a title="hypertrace.agent" href="../index.html">hypertrace.agent</a></code></li>
</ul>
</li>
<li><h3><a href="#header-classes">Classes</a></h3>
<ul>
<li>
<h4><code><a title="hypertrace.agent.init.AgentInit" href="#hypertrace.agent.init.AgentInit">AgentInit</a></code></h4>
<ul class="">
<li><code><a title="hypertrace.agent.init.AgentInit.apply_config" href="#hypertrace.agent.init.AgentInit.apply_config">apply_config</a></code></li>
<li><code><a title="hypertrace.agent.init.AgentInit.init_exporter" href="#hypertrace.agent.init.AgentInit.init_exporter">init_exporter</a></code></li>
<li><code><a title="hypertrace.agent.init.AgentInit.init_library_instrumentation" href="#hypertrace.agent.init.AgentInit.init_library_instrumentation">init_library_instrumentation</a></code></li>
<li><code><a title="hypertrace.agent.init.AgentInit.init_propagation" href="#hypertrace.agent.init.AgentInit.init_propagation">init_propagation</a></code></li>
<li><code><a title="hypertrace.agent.init.AgentInit.init_trace_provider" href="#hypertrace.agent.init.AgentInit.init_trace_provider">init_trace_provider</a></code></li>
<li><code><a title="hypertrace.agent.init.AgentInit.post_fork" href="#hypertrace.agent.init.AgentInit.post_fork">post_fork</a></code></li>
<li><code><a title="hypertrace.agent.init.AgentInit.register_processor" href="#hypertrace.agent.init.AgentInit.register_processor">register_processor</a></code></li>
<li><code><a title="hypertrace.agent.init.AgentInit.set_console_span_processor" href="#hypertrace.agent.init.AgentInit.set_console_span_processor">set_console_span_processor</a></code></li>
</ul>
</li>
</ul>
</li>
</ul>
</nav>
</main>
<footer id="footer">
<p>Generated by <a href="https://pdoc3.github.io/pdoc" title="pdoc: Python API documentation generator"><cite>pdoc</cite> 0.10.0</a>.</p>
</footer>
</body>
</html>