[tox]
skipsdist = true
#envlist = py37, py38, py39
envlist = py37

[testenv]
sitepackages = True
install_command = pip install {opts} {packages}

deps =
    -rrequirements.txt

whitelist_externals =
    pytest
    docker-compose
    sleep

setenv =
  PYTHONPATH=../..
#  OTEL_TRACES_EXPORTER=zipkin
#  OTEL_EXPORTER_ZIPKIN_ENDPOINT=http://localhost:9411/api/v2/spans
  ENABLE_INSTRUMENTATION=False

commands =
    docker-compose stop
    docker-compose build
    docker-compose rm -v -f
    docker-compose up -d flask_app_a
    pytest -rPx test_requests_1.py
    sleep 10
    pytest -rPx test_requests_2.py
    docker-compose stop flask_app_a
    pytest -rPx test_requests_3.py
recreate = True
