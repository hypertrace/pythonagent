[tox]
envlist = test_mysql_instrumentation
skipsdist = true

[testenv]
install_command = pip install {opts} {packages}
basepython=python3.8
sitepackages = True

[testenv:test_mysql_instrumentation]
deps =
    -rrequirements.txt

whitelist_externals =
    docker-compose
    chcon
    sleep
    pytest

setenv =
  PYTHONPATH=../..
  OTEL_TRACES_EXPORTER=zipkin
  OTEL_EXPORTER_ZIPKIN_ENDPOINT=http://localhost:9411/api/v2/spans
commands =
    docker-compose stop
    docker-compose rm -v -f
    docker-compose pull db
    #chcon -Rt svirt_sandbox_file_t sql
    docker-compose up -d db
    sleep 60
    pytest -rPx test_mysql_1.py # Basic INSERT Statement instrumentation test
    pytest -rPx test_mysql_2.py # Flask + Mysql instrumentation test
    pytest -rPx test_mysql_3.py # INSERT with SELECT
    pytest -rPx test_mysql_4.py # UPDATE
    pytest -rPx test_mysql_5.py # DELETE
    pytest -rPx test_mysql_6.py # PROCEDURE
    pytest -rPx test_mysql_7.py # Transaction with inserts
    docker-compose stop db

recreate = True
