[tox]
envlist = py37, py38, py39
skipsdist = true

[testenv]
install_command = pip install {opts} {packages}

deps =
    -rrequirements.txt

whitelist_externals =
    pytest
    docker-compose
    sleep

setenv =
  PYTHONPATH=../../src
  HT_TRACES_EXPORTER=zipkin
  HT_REPORTING_ENDPOINT=http://localhost:9411/api/v2/spans
  HT_LOG_LEVEL=DEBUG
  HT_ENABLE_CONSOLE_SPAN_EXPORTER=True

commands =
    docker-compose up -d
    pytest -rPx test_grpc_1.py
#   pytest -rPx test_grpc_2.py # Broken until future release of otel grpc instrumentation module
    docker-compose stop

recreate = True

